From 64c00e200a6aa81a5d450d789c8e4b41d9d554d7 Mon Sep 17 00:00:00 2001
From: Peter Zhigalov <peter.zhigalov@gmail.com>
Date: Wed, 26 Oct 2022 07:26:20 +0700
Subject: [PATCH 5/5] Windows/VS2005 port, part 2

---
 src/common/sae_pk.c                           |   2 +
 src/pae/ieee802_1x_kay.c                      | 102 ++++-----
 src/utils/build_config.h                      |   9 +
 src/utils/common.h                            |  12 +
 src/utils/pcsc_funcs.c                        |   2 +-
 wpa_supplicant/bgscan_simple.c                |  12 +-
 wpa_supplicant/ctrl_iface_named_pipe.c        |  76 +++---
 wpa_supplicant/eapol_test.c                   |  13 +-
 wpa_supplicant/main_winsvc.c                  |  88 +++++++
 wpa_supplicant/nmake.mak                      |  71 ++++--
 .../vs2005/eapol_test/eapol_test.vcproj       | 158 ++++++++++---
 .../vs2005/win_if_list/win_if_list.vcproj     |  10 +-
 wpa_supplicant/vs2005/wpa_cli/wpa_cli.vcproj  |  20 +-
 .../wpa_passphrase/wpa_passphrase.vcproj      |  35 +--
 .../wpa_supplicant/wpa_supplicant.vcproj      | 164 ++++++++++---
 wpa_supplicant/vs2005/wpasvc/wpasvc.vcproj    | 216 +++++++++++++-----
 wpa_supplicant/wpa_gui-qt4/icons_status.qrc   |   3 +
 wpa_supplicant/wpa_gui-qt4/wpagui.cpp         |   2 +-
 18 files changed, 733 insertions(+), 262 deletions(-)

diff --git a/src/common/sae_pk.c b/src/common/sae_pk.c
index df79e5f..fcebf67 100644
--- a/src/common/sae_pk.c
+++ b/src/common/sae_pk.c
@@ -7,7 +7,9 @@
  */
 
 #include "utils/includes.h"
+#if !defined(_MSC_VER) || (_MSC_VER >= 1600)
 #include <stdint.h>
+#endif
 
 #include "utils/common.h"
 #include "utils/base64.h"
diff --git a/src/pae/ieee802_1x_kay.c b/src/pae/ieee802_1x_kay.c
index 657de93..3709546 100644
--- a/src/pae/ieee802_1x_kay.c
+++ b/src/pae/ieee802_1x_kay.c
@@ -42,17 +42,17 @@ static u8 mka_algo_agility[4] = MKA_ALGO_AGILITY_2009;
 static struct macsec_ciphersuite cipher_suite_tbl[] = {
 	/* GCM-AES-128 */
 	{
-		.id = CS_ID_GCM_AES_128,
-		.name = CS_NAME_GCM_AES_128,
-		.capable = MACSEC_CAP_INTEG_AND_CONF_0_30_50,
-		.sak_len = DEFAULT_SA_KEY_LEN,
+		CS_ID_GCM_AES_128,
+		CS_NAME_GCM_AES_128,
+		MACSEC_CAP_INTEG_AND_CONF_0_30_50,
+		DEFAULT_SA_KEY_LEN,
 	},
 	/* GCM-AES-256 */
 	{
-		.id = CS_ID_GCM_AES_256,
-		.name = CS_NAME_GCM_AES_256,
-		.capable = MACSEC_CAP_INTEG_AND_CONF_0_30_50,
-		.sak_len = 32,
+		CS_ID_GCM_AES_256,
+		CS_NAME_GCM_AES_256,
+		MACSEC_CAP_INTEG_AND_CONF_0_30_50,
+		32,
 	},
 };
 #define CS_TABLE_SIZE (ARRAY_SIZE(cipher_suite_tbl))
@@ -60,15 +60,15 @@ static struct macsec_ciphersuite cipher_suite_tbl[] = {
 
 static struct mka_alg mka_alg_tbl[] = {
 	{
-		.parameter = MKA_ALGO_AGILITY_2009,
+		MKA_ALGO_AGILITY_2009,
 
-		.icv_len = DEFAULT_ICV_LEN,
+		DEFAULT_ICV_LEN,
 
-		.cak_trfm = ieee802_1x_cak_aes_cmac,
-		.ckn_trfm = ieee802_1x_ckn_aes_cmac,
-		.kek_trfm = ieee802_1x_kek_aes_cmac,
-		.ick_trfm = ieee802_1x_ick_aes_cmac,
-		.icv_hash = ieee802_1x_icv_aes_cmac,
+		ieee802_1x_cak_aes_cmac,
+		ieee802_1x_ckn_aes_cmac,
+		ieee802_1x_kek_aes_cmac,
+		ieee802_1x_ick_aes_cmac,
+		ieee802_1x_icv_aes_cmac,
 	},
 };
 #define MKA_ALG_TABLE_SIZE (ARRAY_SIZE(mka_alg_tbl))
@@ -2009,74 +2009,74 @@ struct mka_param_body_handler {
 static struct mka_param_body_handler mka_body_handler[] = {
 	/* Basic parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_basic_body,
-		.body_rx      = NULL,
-		.body_length  = ieee802_1x_mka_basic_body_length,
-		.body_present = ieee802_1x_mka_basic_body_present
+		ieee802_1x_mka_encode_basic_body,
+		NULL,
+		ieee802_1x_mka_basic_body_length,
+		ieee802_1x_mka_basic_body_present
 	},
 
 	/* Live Peer List parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_live_peer_body,
-		.body_rx      = ieee802_1x_mka_decode_live_peer_body,
-		.body_length  = ieee802_1x_mka_get_live_peer_length,
-		.body_present = ieee802_1x_mka_live_peer_body_present
+		ieee802_1x_mka_encode_live_peer_body,
+		ieee802_1x_mka_decode_live_peer_body,
+		ieee802_1x_mka_get_live_peer_length,
+		ieee802_1x_mka_live_peer_body_present
 	},
 
 	/* Potential Peer List parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_potential_peer_body,
-		.body_rx      = ieee802_1x_mka_decode_potential_peer_body,
-		.body_length  = ieee802_1x_mka_get_potential_peer_length,
-		.body_present = ieee802_1x_mka_potential_peer_body_present
+		ieee802_1x_mka_encode_potential_peer_body,
+		ieee802_1x_mka_decode_potential_peer_body,
+		ieee802_1x_mka_get_potential_peer_length,
+		ieee802_1x_mka_potential_peer_body_present
 	},
 
 	/* MACsec SAK Use parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_sak_use_body,
-		.body_rx      = ieee802_1x_mka_decode_sak_use_body,
-		.body_length  = ieee802_1x_mka_get_sak_use_length,
-		.body_present = ieee802_1x_mka_sak_use_body_present
+		ieee802_1x_mka_encode_sak_use_body,
+		ieee802_1x_mka_decode_sak_use_body,
+		ieee802_1x_mka_get_sak_use_length,
+		ieee802_1x_mka_sak_use_body_present
 	},
 
 	/* Distributed SAK parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_dist_sak_body,
-		.body_rx      = ieee802_1x_mka_decode_dist_sak_body,
-		.body_length  = ieee802_1x_mka_get_dist_sak_length,
-		.body_present = ieee802_1x_mka_dist_sak_body_present
+		ieee802_1x_mka_encode_dist_sak_body,
+		ieee802_1x_mka_decode_dist_sak_body,
+		ieee802_1x_mka_get_dist_sak_length,
+		ieee802_1x_mka_dist_sak_body_present
 	},
 
 	/* Distribute CAK parameter set */
 	{
-		.body_tx      = NULL,
-		.body_rx      = ieee802_1x_mka_decode_dist_cak_body,
-		.body_length  = NULL,
-		.body_present = NULL
+		NULL,
+		ieee802_1x_mka_decode_dist_cak_body,
+		NULL,
+		NULL
 	},
 
 	/* KMD parameter set */
 	{
-		.body_tx      = NULL,
-		.body_rx      = ieee802_1x_mka_decode_kmd_body,
-		.body_length  = NULL,
-		.body_present = NULL
+		NULL,
+		ieee802_1x_mka_decode_kmd_body,
+		NULL,
+		NULL
 	},
 
 	/* Announcement parameter set */
 	{
-		.body_tx      = NULL,
-		.body_rx      = ieee802_1x_mka_decode_announce_body,
-		.body_length  = NULL,
-		.body_present = NULL
+		NULL,
+		ieee802_1x_mka_decode_announce_body,
+		NULL,
+		NULL
 	},
 
 	/* ICV Indicator parameter set */
 	{
-		.body_tx      = ieee802_1x_mka_encode_icv_body,
-		.body_rx      = NULL,
-		.body_length  = ieee802_1x_mka_get_icv_length,
-		.body_present = ieee802_1x_mka_icv_body_present
+		ieee802_1x_mka_encode_icv_body,
+		NULL,
+		ieee802_1x_mka_get_icv_length,
+		ieee802_1x_mka_icv_body_present
 	},
 };
 
diff --git a/src/utils/build_config.h b/src/utils/build_config.h
index c6f4e43..46d9f82 100644
--- a/src/utils/build_config.h
+++ b/src/utils/build_config.h
@@ -36,8 +36,17 @@
 #define EAP_TTLS
 #define EAP_GTC
 #define EAP_OTP
+#define EAP_SIM
 #define EAP_LEAP
+#define EAP_PSK
+#define EAP_AKA
+#define EAP_FAST
+#define EAP_PAX
 #define EAP_TNC
+#define EAP_TLS_OPENSSL
+#define CONFIG_SHA256
+#define CONFIG_NO_SOCKLEN_T_TYPEDEF
+#define TLS_DEFAULT_CIPHERS "DEFAULT:!EXP:!LOW"
 #define _CRT_SECURE_NO_DEPRECATE
 
 #ifdef USE_INTERNAL_CRYPTO
diff --git a/src/utils/common.h b/src/utils/common.h
index 59c4d3a..530c7d7 100644
--- a/src/utils/common.h
+++ b/src/utils/common.h
@@ -149,6 +149,15 @@ static inline unsigned int wpa_swap_32(unsigned int v)
 		((v & 0xff0000) >> 8) | (v >> 24);
 }
 
+static inline u64 wpa_swap_64(u64 v)
+{
+	unsigned int hi = (unsigned int)(v >> 32);
+	unsigned int lo = (unsigned int)(v);
+	hi = wpa_swap_32(hi);
+	lo = wpa_swap_32(lo);
+	return (((u64)(lo)) << 32) | hi;
+}
+
 #define le_to_host16(n) (n)
 #define host_to_le16(n) (n)
 #define be_to_host16(n) wpa_swap_16(n)
@@ -157,7 +166,10 @@ static inline unsigned int wpa_swap_32(unsigned int v)
 #define host_to_le32(n) (n)
 #define be_to_host32(n) wpa_swap_32(n)
 #define host_to_be32(n) wpa_swap_32(n)
+#define le_to_host64(n) (n)
 #define host_to_le64(n) (n)
+#define be_to_host64(n) wpa_swap_64(n)
+#define host_to_be64(n) wpa_swap_64(n)
 
 #define WPA_BYTE_SWAP_DEFINED
 
diff --git a/src/utils/pcsc_funcs.c b/src/utils/pcsc_funcs.c
index 8d5e4f9..ef39817 100644
--- a/src/utils/pcsc_funcs.c
+++ b/src/utils/pcsc_funcs.c
@@ -124,7 +124,7 @@ struct scard_data {
 };
 
 /*#ifdef __MINGW32_VERSION*/
-#if 1
+#ifndef UNICODE
 /* MinGW does not yet support WinScard, so load the needed functions
  * dynamically from winscard.dll for now. */
 
diff --git a/wpa_supplicant/bgscan_simple.c b/wpa_supplicant/bgscan_simple.c
index 41a26df..efc82e7 100644
--- a/wpa_supplicant/bgscan_simple.c
+++ b/wpa_supplicant/bgscan_simple.c
@@ -266,10 +266,10 @@ static void bgscan_simple_notify_signal_change(void *priv, int above,
 
 
 const struct bgscan_ops bgscan_simple_ops = {
-	.name = "simple",
-	.init = bgscan_simple_init,
-	.deinit = bgscan_simple_deinit,
-	.notify_scan = bgscan_simple_notify_scan,
-	.notify_beacon_loss = bgscan_simple_notify_beacon_loss,
-	.notify_signal_change = bgscan_simple_notify_signal_change,
+	"simple",
+	bgscan_simple_init,
+	bgscan_simple_deinit,
+	bgscan_simple_notify_scan,
+	bgscan_simple_notify_beacon_loss,
+	bgscan_simple_notify_signal_change,
 };
diff --git a/wpa_supplicant/ctrl_iface_named_pipe.c b/wpa_supplicant/ctrl_iface_named_pipe.c
index 1f29336..721ea1c 100644
--- a/wpa_supplicant/ctrl_iface_named_pipe.c
+++ b/wpa_supplicant/ctrl_iface_named_pipe.c
@@ -53,48 +53,48 @@ ConvertStringSecurityDescriptorToSecurityDescriptorA
 #undef ConvertStringSecurityDescriptorToSecurityDescriptor
 #endif
 
-BOOL ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
-    LPCSTR StringSecurityDescriptor, DWORD StringSDRevision,
-    PSECURITY_DESCRIPTOR *SecurityDescriptor, PULONG SecurityDescriptorSize)
+static BOOL ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
+	LPCSTR StringSecurityDescriptor, DWORD StringSDRevision,
+	PSECURITY_DESCRIPTOR *SecurityDescriptor, PULONG SecurityDescriptorSize)
 {
-    (void)StringSecurityDescriptor;
-    (void)StringSDRevision;
-    *SecurityDescriptor = NULL;
-    *SecurityDescriptorSize = 0;
-    return TRUE;
+	(void)StringSecurityDescriptor;
+	(void)StringSDRevision;
+	*SecurityDescriptor = NULL;
+	*SecurityDescriptorSize = 0;
+	return TRUE;
 }
 
-BOOL ConvertStringSecurityDescriptorToSecurityDescriptor_impl(
-    LPCSTR StringSecurityDescriptor, DWORD StringSDRevision,
-    PSECURITY_DESCRIPTOR *SecurityDescriptor, PULONG SecurityDescriptorSize)
+static BOOL ConvertStringSecurityDescriptorToSecurityDescriptor_impl(
+	LPCSTR StringSecurityDescriptor, DWORD StringSDRevision,
+	PSECURITY_DESCRIPTOR *SecurityDescriptor, PULONG SecurityDescriptorSize)
 {
-    typedef BOOL (WINAPI *func_t)(LPCSTR, DWORD, PSECURITY_DESCRIPTOR *, PULONG);
-    HINSTANCE dll;
-    BOOL result;
-    func_t func;
-
-    dll = LoadLibrary("advapi32");
-    if (dll == NULL) {
-        wpa_printf(MSG_DEBUG, "CTRL: Could not load advapi32.dll library");
-        result = ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
-                    StringSecurityDescriptor, StringSDRevision,
-                    SecurityDescriptor, SecurityDescriptorSize);
-        return result;
-    }
-
-    func = (func_t)GetProcAddress(dll, "ConvertStringSecurityDescriptorToSecurityDescriptorA");
-    if (func == NULL) {
-        wpa_printf(MSG_DEBUG, "CTRL: Could not resolve ConvertStringSecurityDescriptorToSecurityDescriptorA");
-        result = ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
-                    StringSecurityDescriptor, StringSDRevision,
-                    SecurityDescriptor, SecurityDescriptorSize);
-    } else {
-        result = func(StringSecurityDescriptor, StringSDRevision,
-                      SecurityDescriptor, SecurityDescriptorSize);
-    }
-
-    FreeLibrary(dll);
-    return result;
+	typedef BOOL (WINAPI *func_t)(LPCSTR, DWORD, PSECURITY_DESCRIPTOR *, PULONG);
+	HINSTANCE dll;
+	BOOL result;
+	func_t func;
+
+	dll = LoadLibrary("advapi32");
+	if (dll == NULL) {
+		wpa_printf(MSG_DEBUG, "CTRL: Could not load advapi32.dll library");
+		result = ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
+					StringSecurityDescriptor, StringSDRevision,
+					SecurityDescriptor, SecurityDescriptorSize);
+		return result;
+	}
+
+	func = (func_t)GetProcAddress(dll, "ConvertStringSecurityDescriptorToSecurityDescriptorA");
+	if (func == NULL) {
+		wpa_printf(MSG_DEBUG, "CTRL: Could not resolve ConvertStringSecurityDescriptorToSecurityDescriptorA");
+		result = ConvertStringSecurityDescriptorToSecurityDescriptor_fb(
+					StringSecurityDescriptor, StringSDRevision,
+					SecurityDescriptor, SecurityDescriptorSize);
+	} else {
+		result = func(StringSecurityDescriptor, StringSDRevision,
+					  SecurityDescriptor, SecurityDescriptorSize);
+	}
+
+	FreeLibrary(dll);
+	return result;
 }
 
 #define ConvertStringSecurityDescriptorToSecurityDescriptor ConvertStringSecurityDescriptorToSecurityDescriptor_impl
diff --git a/wpa_supplicant/eapol_test.c b/wpa_supplicant/eapol_test.c
index e256ac5..034e1c2 100644
--- a/wpa_supplicant/eapol_test.c
+++ b/wpa_supplicant/eapol_test.c
@@ -986,12 +986,7 @@ static int driver_get_capa(void *priv, struct wpa_driver_capa *capa)
 }
 
 
-struct wpa_driver_ops eapol_test_drv_ops = {
-	.name = "test",
-	.get_ssid = driver_get_ssid,
-	.get_bssid = driver_get_bssid,
-	.get_capa = driver_get_capa,
-};
+struct wpa_driver_ops eapol_test_drv_ops;
 
 static void wpa_init_conf(struct eapol_test_data *e,
 			  struct wpa_supplicant *wpa_s, const char *authsrv,
@@ -1001,6 +996,12 @@ static void wpa_init_conf(struct eapol_test_data *e,
 	struct hostapd_radius_server *as;
 	int res;
 
+	os_memset(&eapol_test_drv_ops, 0, sizeof(eapol_test_drv_ops));
+	eapol_test_drv_ops.name = "test";
+	eapol_test_drv_ops.get_ssid = driver_get_ssid;
+	eapol_test_drv_ops.get_bssid = driver_get_bssid;
+	eapol_test_drv_ops.get_capa = driver_get_capa;
+
 	wpa_s->driver = &eapol_test_drv_ops;
 	wpa_s->drv_priv = e;
 	wpa_s->bssid[5] = 1;
diff --git a/wpa_supplicant/main_winsvc.c b/wpa_supplicant/main_winsvc.c
index 9950aa9..8211097 100644
--- a/wpa_supplicant/main_winsvc.c
+++ b/wpa_supplicant/main_winsvc.c
@@ -27,6 +27,38 @@
 #include "wpa_supplicant_i.h"
 #include "eloop.h"
 
+#ifndef UNICODE
+static BOOL ChangeServiceConfig2A_impl(SC_HANDLE hService, DWORD dwInfoLevel, LPVOID lpInfo)
+{
+	typedef BOOL (WINAPI *func_t)(SC_HANDLE, DWORD, LPVOID);
+	HINSTANCE dll;
+	BOOL result;
+	func_t func;
+
+	dll = LoadLibrary("advapi32");
+	if (dll == NULL) {
+		printf("ChangeServiceConfig2: Could not load advapi32.dll library");
+		result = FALSE;
+		return result;
+	}
+
+	func = (func_t)GetProcAddress(dll, "ChangeServiceConfig2A");
+	if (func == NULL) {
+		printf("ChangeServiceConfig2: Could not resolve ChangeServiceConfig2A");
+		result = FALSE;
+	} else {
+		result = func(hService, dwInfoLevel, lpInfo);
+	}
+
+	FreeLibrary(dll);
+	return result;
+}
+#ifdef ChangeServiceConfig2
+#undef ChangeServiceConfig2
+#endif
+#define ChangeServiceConfig2 ChangeServiceConfig2A_impl
+#endif
+
 #ifndef WPASVC_NAME
 #define WPASVC_NAME TEXT("wpasvc")
 #endif
@@ -131,6 +163,59 @@ static int read_interface(struct wpa_global *global, HKEY _hk,
 }
 
 
+static void prepare_registry(void)
+{
+	LONG ret;
+	HKEY hk, ihk;
+
+	hk = NULL;
+	ret = RegOpenKeyEx(WPA_KEY_ROOT, WPA_KEY_PREFIX, 0, KEY_QUERY_VALUE, &hk);
+	if (ret == ERROR_FILE_NOT_FOUND) {
+		hk = NULL;
+		ret = RegCreateKeyEx(WPA_KEY_ROOT, WPA_KEY_PREFIX, 0, NULL, 0, KEY_WRITE, NULL, &hk, NULL);
+		if (ret == ERROR_SUCCESS) {
+			DWORD dwVal = 0;
+			RegSetValueEx(hk, TEXT("debug_level"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+			RegSetValueEx(hk, TEXT("debug_show_keys"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+			RegSetValueEx(hk, TEXT("debug_timestamp"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+			RegSetValueEx(hk, TEXT("debug_use_file"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+		}
+	}
+	if (!hk)
+		return;
+
+	ihk = NULL;
+	ret = RegOpenKeyEx(hk, TEXT("interfaces"), 0, KEY_QUERY_VALUE, &ihk);
+	if (ret == ERROR_FILE_NOT_FOUND)
+		RegCreateKeyEx(hk, TEXT("interfaces"), 0, NULL, 0, KEY_WRITE, NULL, &ihk, NULL);
+	if (ihk)
+		RegCloseKey(ihk);
+
+	ihk = NULL;
+	ret = RegOpenKeyEx(hk, TEXT("configs\\default"), 0, KEY_QUERY_VALUE, &ihk);
+	if (ret == ERROR_FILE_NOT_FOUND) {
+		ret = RegCreateKeyEx(hk, TEXT("configs\\default"), 0, NULL, 0, KEY_WRITE, NULL, &ihk, NULL);
+		if (ret == ERROR_SUCCESS) {
+			DWORD dwVal = 2;
+			RegSetValueEx(ihk, TEXT("ap_scan"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+			dwVal = 1;
+			RegSetValueEx(ihk, TEXT("update_config"), 0, REG_DWORD, (BYTE*)(&dwVal), sizeof(DWORD));
+		}
+	}
+	if (ihk)
+		RegCloseKey(ihk);
+
+	ihk = NULL;
+	ret = RegOpenKeyEx(hk, TEXT("configs\\default\\networks"), 0, KEY_QUERY_VALUE, &ihk);
+	if (ret == ERROR_FILE_NOT_FOUND)
+		RegCreateKeyEx(hk, TEXT("configs\\default\\networks"), 0, NULL, 0, KEY_WRITE, NULL, &ihk, NULL);
+	if (ihk)
+		RegCloseKey(ihk);
+
+	RegCloseKey(hk);
+}
+
+
 static int wpa_supplicant_thread(void)
 {
 	int exitcode;
@@ -146,6 +231,8 @@ static int wpa_supplicant_thread(void)
 	os_memset(&params, 0, sizeof(params));
 	params.wpa_debug_level = MSG_INFO;
 
+	prepare_registry();
+
 	ret = RegOpenKeyEx(WPA_KEY_ROOT, WPA_KEY_PREFIX,
 			   0, KEY_QUERY_VALUE, &hk);
 	if (ret != ERROR_SUCCESS) {
@@ -439,6 +526,7 @@ int main(int argc, char *argv[])
 				if (path == NULL)
 					return -1;
 			}
+			prepare_registry();
 			ret = register_service(path);
 			os_free(path);
 			return ret;
diff --git a/wpa_supplicant/nmake.mak b/wpa_supplicant/nmake.mak
index 617df03..27c367e 100644
--- a/wpa_supplicant/nmake.mak
+++ b/wpa_supplicant/nmake.mak
@@ -9,7 +9,8 @@ all: wpa_supplicant.exe wpa_cli.exe wpa_passphrase.exe wpasvc.exe win_if_list.ex
 
 # Root directory for WinPcap developer's pack
 # (http://www.winpcap.org/install/bin/WpdPack_3_1.zip)
-WINPCAPDIR=C:\dev\WpdPack
+#WINPCAPDIR=C:\dev\WpdPack
+WINPCAPDIR=..\..\WpdPack
 
 # Root directory for OpenSSL
 # (http://www.openssl.org/source/openssl-0.9.8a.tar.gz)
@@ -18,7 +19,8 @@ WINPCAPDIR=C:\dev\WpdPack
 # support it (openssl-tls-extensions.patch)
 # Alternatively, see README-Windows.txt for information about binary
 # installation package for OpenSSL.
-OPENSSLDIR=C:\dev\openssl
+#OPENSSLDIR=C:\dev\openssl
+OPENSSLDIR=..\..\openssl-1.1.1-x86
 
 CC = cl
 OBJDIR = objs
@@ -40,18 +42,23 @@ CFLAGS = $(CFLAGS) /DEAP_SIM
 CFLAGS = $(CFLAGS) /DEAP_LEAP
 CFLAGS = $(CFLAGS) /DEAP_PSK
 CFLAGS = $(CFLAGS) /DEAP_AKA
-#CFLAGS = $(CFLAGS) /DEAP_FAST
+CFLAGS = $(CFLAGS) /DEAP_FAST
 CFLAGS = $(CFLAGS) /DEAP_PAX
 CFLAGS = $(CFLAGS) /DEAP_TNC
 CFLAGS = $(CFLAGS) /DPCSC_FUNCS
 CFLAGS = $(CFLAGS) /DCONFIG_CTRL_IFACE
 CFLAGS = $(CFLAGS) /DCONFIG_CTRL_IFACE_NAMED_PIPE
 CFLAGS = $(CFLAGS) /DCONFIG_DRIVER_NDIS
+CFLAGS = $(CFLAGS) /DEAP_TLS_OPENSSL
+CFLAGS = $(CFLAGS) /DCONFIG_SHA256
+CFLAGS = $(CFLAGS) /DCONFIG_NO_SOCKLEN_T_TYPEDEF
+CFLAGS = $(CFLAGS) /DTLS_DEFAULT_CIPHERS=\"DEFAULT:!EXP:!LOW\"
 CFLAGS = $(CFLAGS) /I..\src /I..\src\utils
 CFLAGS = $(CFLAGS) /I.
 CFLAGS = $(CFLAGS) /DWIN32
 CFLAGS = $(CFLAGS) /Fo$(OBJDIR)\\ /c
 CFLAGS = $(CFLAGS) /W3
+CFLAGS = $(CFLAGS) /wd4244 /wd4267 /wd4311 /wd4996
 
 #CFLAGS = $(CFLAGS) /WX
 
@@ -60,19 +67,36 @@ CFLAGS = $(CFLAGS) /W3
 CFLAGS = $(CFLAGS) /D_CRT_SECURE_NO_DEPRECATE
 
 OBJS = \
+	$(OBJDIR)\config___wpasup.obj \
+	$(OBJDIR)\config___utils.obj \
+	$(OBJDIR)\op_classes.obj \
+	$(OBJDIR)\random.obj \
+	$(OBJDIR)\robust_av.obj \
+	$(OBJDIR)\rrm.obj \
+	$(OBJDIR)\sha256-prf.obj \
+	$(OBJDIR)\sha256-tlsprf.obj \
+	$(OBJDIR)\tls_openssl_ocsp.obj \
+	$(OBJDIR)\twt.obj \
+	$(OBJDIR)\wmm_ac.obj \
+	$(OBJDIR)\hw_features_common.obj \
+	$(OBJDIR)\ieee802_11_common.obj \
+	$(OBJDIR)\ip_addr.obj \
+	$(OBJDIR)\eap_fast.obj \
+	$(OBJDIR)\eap_fast_common.obj \
+	$(OBJDIR)\eap_fast_pac.obj \
+	$(OBJDIR)\crc32.obj \
+	$(OBJDIR)\driver_common.obj \
+	$(OBJDIR)\bitfield.obj \
+	$(OBJDIR)\bss.obj \
+	$(OBJDIR)\sha1-prf.obj \
+	$(OBJDIR)\sha1-tprf.obj \
 	$(OBJDIR)\os_win32.obj \
 	$(OBJDIR)\eloop_win.obj \
-	$(OBJDIR)\sha1.obj \
 	$(OBJDIR)\sha1-tlsprf.obj \
-	$(OBJDIR)\sha1-pbkdf2.obj \
-	$(OBJDIR)\md5.obj \
-	$(OBJDIR)\aes-cbc.obj \
 	$(OBJDIR)\aes-ctr.obj \
 	$(OBJDIR)\aes-eax.obj \
 	$(OBJDIR)\aes-encblock.obj \
 	$(OBJDIR)\aes-omac1.obj \
-	$(OBJDIR)\aes-unwrap.obj \
-	$(OBJDIR)\aes-wrap.obj \
 	$(OBJDIR)\common.obj \
 	$(OBJDIR)\wpa_debug.obj \
 	$(OBJDIR)\wpabuf.obj \
@@ -112,13 +136,11 @@ OBJS = \
 	$(OBJDIR)\ctrl_iface_named_pipe.obj \
 	$(OBJDIR)\driver_ndis.obj \
 	$(OBJDIR)\driver_ndis_.obj \
-	$(OBJDIR)\scan_helpers.obj \
 	$(OBJDIR)\events.obj \
 	$(OBJDIR)\bssid_ignore.obj \
 	$(OBJDIR)\scan.obj \
 	$(OBJDIR)\wpas_glue.obj \
 	$(OBJDIR)\eap_register.obj \
-	$(OBJDIR)\config.obj \
 	$(OBJDIR)\l2_packet_winpcap.obj \
 	$(OBJDIR)\tls_openssl.obj \
 	$(OBJDIR)\ms_funcs.obj \
@@ -128,17 +150,15 @@ OBJS = \
 	$(OBJDIR)\notify.obj \
 	$(OBJDIR)\ndis_events.obj
 
-# OBJS = $(OBJS) $(OBJDIR)\eap_fast.obj
-
 OBJS_t = $(OBJS) \
 	$(OBJDIR)\eapol_test.obj \
 	$(OBJDIR)\radius.obj \
 	$(OBJDIR)\radius_client.obj \
-	$(OBJDIR)\config_file.obj $(OBJDIR)\base64.obj
+	$(OBJDIR)\config_file.obj
 
 OBJS_t2 = $(OBJS) \
 	$(OBJDIR)\preauth_test.obj \
-	$(OBJDIR)\config_file.obj $(OBJDIR)\base64.obj
+	$(OBJDIR)\config_file.obj
 
 OBJS2 = $(OBJDIR)\drivers.obj \
 	$(OBJDIR)\config_file.obj \
@@ -149,6 +169,10 @@ OBJS3 = $(OBJDIR)\drivers.obj \
 	$(OBJS3) $(OBJDIR)\main_winsvc.obj
 
 OBJS_c = \
+	$(OBJDIR)\cli.obj \
+	$(OBJDIR)\edit_simple.obj \
+	$(OBJDIR)\eloop_win.obj \
+	$(OBJDIR)\wpa_debug.obj \
 	$(OBJDIR)\os_win32.obj \
 	$(OBJDIR)\wpa_cli.obj \
 	$(OBJDIR)\wpa_ctrl.obj \
@@ -159,16 +183,13 @@ OBJS_p = \
 	$(OBJDIR)\common.obj \
 	$(OBJDIR)\wpa_debug.obj \
 	$(OBJDIR)\wpabuf.obj \
-	$(OBJDIR)\sha1.obj \
-	$(OBJDIR)\md5.obj \
 	$(OBJDIR)\crypto_openssl.obj \
-	$(OBJDIR)\sha1-pbkdf2.obj \
 	$(OBJDIR)\wpa_passphrase.obj
 
 LIBS = wbemuuid.lib libcmt.lib kernel32.lib uuid.lib ole32.lib oleaut32.lib \
 	ws2_32.lib Advapi32.lib Crypt32.lib Winscard.lib \
 	Packet.lib wpcap.lib \
-	libeay32.lib ssleay32.lib
+	libcrypto.lib libssl.lib User32.lib
 # If using Win32 OpenSSL binary installation from Shining Light Productions,
 # replace the last line with this for dynamic libraries
 #	libeay32MT.lib ssleay32MT.lib
@@ -227,14 +248,26 @@ win_if_list.exe: $(OBJDIR) $(OBJDIR)\win_if_list.obj
 {..\src\l2_packet}.c{$(OBJDIR)}.obj::
 	$(CC) $(CFLAGS) $<
 
+{..\src\radius}.c{$(OBJDIR)}.obj::
+	$(CC) $(CFLAGS) $<
+
 {.\}.c{$(OBJDIR)}.obj::
 	$(CC) $(CFLAGS) $<
 
 {.\}.cpp{$(OBJDIR)}.obj::
 	$(CC) $(CFLAGS) $<
 
+# @todo Conflict between src/utils/config.c and wpa_supplicant/config.c
+$(OBJDIR)\config___wpasup.obj:
+	$(CC) $(CFLAGS) .\config.c /Fo$(OBJDIR)\config___wpasup.obj
+
+$(OBJDIR)\config___utils.obj:
+	$(CC) $(CFLAGS) ..\src\utils\config.c /Fo$(OBJDIR)\config___utils.obj
+
 $(OBJDIR):
 	if not exist "$(OBJDIR)" mkdir "$(OBJDIR)"
 
 clean:
 	erase $(OBJDIR)\*.obj wpa_supplicant.exe
+	erase wpa_cli.exe wpa_passphrase.exe wpasvc.exe win_if_list.exe
+	erase eapol_test.exe preauth_test.exe
diff --git a/wpa_supplicant/vs2005/eapol_test/eapol_test.vcproj b/wpa_supplicant/vs2005/eapol_test/eapol_test.vcproj
index c92b8fd..50cded3 100755
--- a/wpa_supplicant/vs2005/eapol_test/eapol_test.vcproj
+++ b/wpa_supplicant/vs2005/eapol_test/eapol_test.vcproj
@@ -40,7 +40,7 @@
 			<Tool
 				Name="VCCLCompilerTool"
 				Optimization="0"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;_DEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				MinimalRebuild="true"
 				BasicRuntimeChecks="3"
@@ -49,7 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -62,9 +62,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="2"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				TargetMachine="1"
@@ -119,14 +119,14 @@
 			/>
 			<Tool
 				Name="VCCLCompilerTool"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;NDEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				RuntimeLibrary="2"
 				UsePrecompiledHeader="0"
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -139,9 +139,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="1"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				OptimizeReferences="2"
@@ -182,10 +182,6 @@
 			Filter="cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx"
 			UniqueIdentifier="{4FC737F1-C7A5-4376-A066-2A32D752A2FF}"
 			>
-			<File
-				RelativePath="..\..\..\src\crypto\aes-cbc.c"
-				>
-			</File>
 			<File
 				RelativePath="..\..\..\src\crypto\aes-ctr.c"
 				>
@@ -203,15 +199,15 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-unwrap.c"
+				RelativePath="..\..\..\src\utils\base64.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-wrap.c"
+				RelativePath="..\..\..\src\utils\bitfield.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\base64.c"
+				RelativePath="..\..\bss.c"
 				>
 			</File>
 			<File
@@ -219,27 +215,59 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\bss.c"
+				RelativePath="..\..\..\src\eap_common\chap.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_common\chap.c"
+				RelativePath="..\..\..\src\utils\common.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\common.c"
+				RelativePath="..\..\config.c"
 				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
 			</File>
 			<File
 				RelativePath="..\..\..\src\utils\config.c"
 				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
 			</File>
 			<File
-				RelativePath="..\..\config.c"
+				RelativePath="..\..\config_file.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\config_file.c"
+				RelativePath="..\..\..\src\utils\crc32.c"
 				>
 			</File>
 			<File
@@ -258,6 +286,14 @@
 				RelativePath="..\..\..\src\drivers\driver_common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\drivers\driver_ndis.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\drivers\driver_ndis_.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap.c"
 				>
@@ -270,6 +306,18 @@
 				RelativePath="..\..\..\src\eap_common\eap_common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_fast_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast_pac.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_gtc.c"
 				>
@@ -294,6 +342,14 @@
 				RelativePath="..\..\..\src\eap_peer\eap_otp.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_pax.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_pax_common.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_peap.c"
 				>
@@ -302,6 +358,14 @@
 				RelativePath="..\..\..\src\eap_common\eap_peap_common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_psk.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_psk_common.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\eap_register.c"
 				>
@@ -351,15 +415,19 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\ip_addr.c"
+				RelativePath="..\..\..\src\common\hw_features_common.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\l2_packet\l2_packet_winpcap.c"
+				RelativePath="..\..\..\src\common\ieee802_11_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\ip_addr.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\md5.c"
+				RelativePath="..\..\..\src\l2_packet\l2_packet_winpcap.c"
 				>
 			</File>
 			<File
@@ -370,20 +438,24 @@
 				RelativePath="..\..\..\src\eap_peer\mschapv2.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\drivers\ndis_events.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\notify.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\os_win32.c"
+				RelativePath="..\..\op_classes.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\pcsc_funcs.c"
+				RelativePath="..\..\..\src\utils\os_win32.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\peerkey.c"
+				RelativePath="..\..\..\src\utils\pcsc_funcs.c"
 				>
 			</File>
 			<File
@@ -403,15 +475,19 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\scan.c"
+				RelativePath="..\..\..\src\crypto\random.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1.c"
+				RelativePath="..\..\robust_av.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-pbkdf2.c"
+				RelativePath="..\..\rrm.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\scan.c"
 				>
 			</File>
 			<File
@@ -422,14 +498,38 @@
 				RelativePath="..\..\..\src\crypto\sha1-tlsprf.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha1-tprf.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha256-prf.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha256-tlsprf.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\crypto\tls_openssl.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\tls_openssl_ocsp.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\tncc.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\twt.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\wmm_ac.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\rsn_supp\wpa.c"
 				>
diff --git a/wpa_supplicant/vs2005/win_if_list/win_if_list.vcproj b/wpa_supplicant/vs2005/win_if_list/win_if_list.vcproj
index e79fc0f..24e5630 100755
--- a/wpa_supplicant/vs2005/win_if_list/win_if_list.vcproj
+++ b/wpa_supplicant/vs2005/win_if_list/win_if_list.vcproj
@@ -40,7 +40,7 @@
 			<Tool
 				Name="VCCLCompilerTool"
 				Optimization="0"
-				AdditionalIncludeDirectories="..\..\..\src\utils;C:\dev\WpdPack\include"
+				AdditionalIncludeDirectories="..\..\..\src\utils;..\..\..\..\WpdPack\include"
 				PreprocessorDefinitions="WIN32;_DEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				MinimalRebuild="true"
 				BasicRuntimeChecks="3"
@@ -49,6 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
+				DisableSpecificWarnings="4244"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -63,7 +64,7 @@
 				Name="VCLinkerTool"
 				AdditionalDependencies="wpcap.lib"
 				LinkIncremental="2"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				TargetMachine="1"
@@ -118,13 +119,14 @@
 			/>
 			<Tool
 				Name="VCCLCompilerTool"
-				AdditionalIncludeDirectories="..\..\..\src\utils;C:\dev\WpdPack\include"
+				AdditionalIncludeDirectories="..\..\..\src\utils;..\..\..\..\WpdPack\include"
 				PreprocessorDefinitions="WIN32;NDEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				RuntimeLibrary="2"
 				UsePrecompiledHeader="0"
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
+				DisableSpecificWarnings="4244"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -139,7 +141,7 @@
 				Name="VCLinkerTool"
 				AdditionalDependencies="wpcap.lib"
 				LinkIncremental="1"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				OptimizeReferences="2"
diff --git a/wpa_supplicant/vs2005/wpa_cli/wpa_cli.vcproj b/wpa_supplicant/vs2005/wpa_cli/wpa_cli.vcproj
index d2de768..997b854 100755
--- a/wpa_supplicant/vs2005/wpa_cli/wpa_cli.vcproj
+++ b/wpa_supplicant/vs2005/wpa_cli/wpa_cli.vcproj
@@ -49,7 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
-				DisableSpecificWarnings="4244;4267"
+				DisableSpecificWarnings="4244;4267;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -125,7 +125,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
-				DisableSpecificWarnings="4244;4267"
+				DisableSpecificWarnings="4244;4267;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -180,10 +180,22 @@
 			Filter="cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx"
 			UniqueIdentifier="{4FC737F1-C7A5-4376-A066-2A32D752A2FF}"
 			>
+			<File
+				RelativePath="..\..\..\src\common\cli.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\utils\common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\utils\edit_simple.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\eloop_win.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\utils\os_win32.c"
 				>
@@ -196,6 +208,10 @@
 				RelativePath="..\..\..\src\common\wpa_ctrl.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\utils\wpa_debug.c"
+				>
+			</File>
 		</Filter>
 		<Filter
 			Name="Header Files"
diff --git a/wpa_supplicant/vs2005/wpa_passphrase/wpa_passphrase.vcproj b/wpa_supplicant/vs2005/wpa_passphrase/wpa_passphrase.vcproj
index 97aa2c5..8808892 100755
--- a/wpa_supplicant/vs2005/wpa_passphrase/wpa_passphrase.vcproj
+++ b/wpa_supplicant/vs2005/wpa_passphrase/wpa_passphrase.vcproj
@@ -40,7 +40,7 @@
 			<Tool
 				Name="VCCLCompilerTool"
 				Optimization="0"
-				AdditionalIncludeDirectories="..\..\..\src;..\..\..\src\utils;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..\..\src;..\..\..\src\utils;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;_DEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				MinimalRebuild="true"
 				BasicRuntimeChecks="3"
@@ -49,7 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
-				DisableSpecificWarnings="4244;4267"
+				DisableSpecificWarnings="4244;4267;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -62,9 +62,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="ws2_32.lib"
+				AdditionalDependencies="ws2_32.lib Crypt32.lib libcrypto.lib"
 				LinkIncremental="2"
-				AdditionalLibraryDirectories=""
+				AdditionalLibraryDirectories="..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				TargetMachine="1"
@@ -119,14 +119,14 @@
 			/>
 			<Tool
 				Name="VCCLCompilerTool"
-				AdditionalIncludeDirectories="..\..\..\src;..\..\..\src\utils;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..\..\src;..\..\..\src\utils;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;NDEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				RuntimeLibrary="2"
 				UsePrecompiledHeader="0"
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
-				DisableSpecificWarnings="4244;4267"
+				DisableSpecificWarnings="4244;4267;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -139,8 +139,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="ws2_32.lib"
+				AdditionalDependencies="ws2_32.lib Crypt32.lib libcrypto.lib"
 				LinkIncremental="1"
+				AdditionalLibraryDirectories="..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				OptimizeReferences="2"
@@ -186,11 +187,7 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\md5.c"
-				>
-			</File>
-			<File
-				RelativePath="..\..\..\src\crypto\md5-internal.c"
+				RelativePath="..\..\..\src\crypto\crypto_openssl.c"
 				>
 			</File>
 			<File
@@ -198,23 +195,15 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1.c"
-				>
-			</File>
-			<File
-				RelativePath="..\..\..\src\crypto\sha1-internal.c"
+				RelativePath="..\..\..\src\utils\wpa_debug.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-prf.c"
-				>
-			</File>
-			<File
-				RelativePath="..\..\..\src\crypto\sha1-pbkdf2.c"
+				RelativePath="..\..\wpa_passphrase.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\wpa_passphrase.c"
+				RelativePath="..\..\..\src\utils\wpabuf.c"
 				>
 			</File>
 		</Filter>
diff --git a/wpa_supplicant/vs2005/wpa_supplicant/wpa_supplicant.vcproj b/wpa_supplicant/vs2005/wpa_supplicant/wpa_supplicant.vcproj
index 10c05b5..4eef3de 100755
--- a/wpa_supplicant/vs2005/wpa_supplicant/wpa_supplicant.vcproj
+++ b/wpa_supplicant/vs2005/wpa_supplicant/wpa_supplicant.vcproj
@@ -40,7 +40,7 @@
 			<Tool
 				Name="VCCLCompilerTool"
 				Optimization="0"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;_DEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				MinimalRebuild="true"
 				BasicRuntimeChecks="3"
@@ -49,7 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -62,9 +62,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="2"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				TargetMachine="1"
@@ -119,14 +119,14 @@
 			/>
 			<Tool
 				Name="VCCLCompilerTool"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;NDEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				RuntimeLibrary="2"
 				UsePrecompiledHeader="0"
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -139,9 +139,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="1"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				OptimizeReferences="2"
@@ -182,10 +182,6 @@
 			Filter="cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx"
 			UniqueIdentifier="{4FC737F1-C7A5-4376-A066-2A32D752A2FF}"
 			>
-			<File
-				RelativePath="..\..\..\src\crypto\aes-cbc.c"
-				>
-			</File>
 			<File
 				RelativePath="..\..\..\src\crypto\aes-ctr.c"
 				>
@@ -203,25 +199,21 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-unwrap.c"
+				RelativePath="..\..\..\src\utils\base64.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-wrap.c"
+				RelativePath="..\..\..\src\utils\bitfield.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\base64.c"
+				RelativePath="..\..\bss.c"
 				>
 			</File>
 			<File
 				RelativePath="..\..\bssid_ignore.c"
 				>
 			</File>
-			<File
-				RelativePath="..\..\bss.c"
-				>
-			</File>
 			<File
 				RelativePath="..\..\..\src\eap_common\chap.c"
 				>
@@ -233,15 +225,51 @@
 			<File
 				RelativePath="..\..\..\src\utils\config.c"
 				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
 			</File>
 			<File
 				RelativePath="..\..\config.c"
 				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
 			</File>
 			<File
 				RelativePath="..\..\config_file.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\utils\crc32.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\crypto\crypto_openssl.c"
 				>
@@ -274,10 +302,26 @@
 				RelativePath="..\..\..\src\eap_peer\eap.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_aka.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_common\eap_common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_fast_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast_pac.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_gtc.c"
 				>
@@ -302,6 +346,14 @@
 				RelativePath="..\..\..\src\eap_peer\eap_otp.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_pax.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_pax_common.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_peap.c"
 				>
@@ -310,10 +362,26 @@
 				RelativePath="..\..\..\src\eap_common\eap_peap_common.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_psk.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_psk_common.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\eap_register.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_sim.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_sim_common.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_tls.c"
 				>
@@ -343,15 +411,27 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\l2_packet\l2_packet_winpcap.c"
+				RelativePath="..\..\..\src\crypto\fips_prf_openssl.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\main.c"
+				RelativePath="..\..\..\src\common\hw_features_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\common\ieee802_11_common.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\md5.c"
+				RelativePath="..\..\..\src\utils\ip_addr.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\l2_packet\l2_packet_winpcap.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\main.c"
 				>
 			</File>
 			<File
@@ -371,15 +451,15 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\os_win32.c"
+				RelativePath="..\..\op_classes.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\pcsc_funcs.c"
+				RelativePath="..\..\..\src\utils\os_win32.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\peerkey.c"
+				RelativePath="..\..\..\src\utils\pcsc_funcs.c"
 				>
 			</File>
 			<File
@@ -391,15 +471,19 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\scan.c"
+				RelativePath="..\..\..\src\crypto\random.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1.c"
+				RelativePath="..\..\robust_av.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-pbkdf2.c"
+				RelativePath="..\..\rrm.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\scan.c"
 				>
 			</File>
 			<File
@@ -410,14 +494,38 @@
 				RelativePath="..\..\..\src\crypto\sha1-tlsprf.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha1-tprf.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha256-prf.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\sha256-tlsprf.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\crypto\tls_openssl.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\crypto\tls_openssl_ocsp.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\tncc.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\twt.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\wmm_ac.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\rsn_supp\wpa.c"
 				>
diff --git a/wpa_supplicant/vs2005/wpasvc/wpasvc.vcproj b/wpa_supplicant/vs2005/wpasvc/wpasvc.vcproj
index 82d9033..4685e83 100755
--- a/wpa_supplicant/vs2005/wpasvc/wpasvc.vcproj
+++ b/wpa_supplicant/vs2005/wpasvc/wpasvc.vcproj
@@ -40,7 +40,7 @@
 			<Tool
 				Name="VCCLCompilerTool"
 				Optimization="0"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;_DEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				MinimalRebuild="true"
 				BasicRuntimeChecks="3"
@@ -49,7 +49,7 @@
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="4"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -62,9 +62,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="2"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+				AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				TargetMachine="1"
@@ -119,14 +119,14 @@
 			/>
 			<Tool
 				Name="VCCLCompilerTool"
-				AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;C:\dev\WpdPack\include;C:\dev\openssl\include"
+                AdditionalIncludeDirectories="..\..;..\..\..\src;..\..\..\src\utils;..\..\..\..\WpdPack\include;..\..\..\..\openssl-1.1.1-x86\include"
 				PreprocessorDefinitions="WIN32;NDEBUG;_CONSOLE;CONFIG_WIN32_DEFAULTS"
 				RuntimeLibrary="2"
 				UsePrecompiledHeader="0"
 				WarningLevel="3"
 				Detect64BitPortabilityProblems="true"
 				DebugInformationFormat="3"
-				DisableSpecificWarnings="4244;4267;4311"
+				DisableSpecificWarnings="4244;4267;4311;4996"
 			/>
 			<Tool
 				Name="VCManagedResourceCompilerTool"
@@ -139,9 +139,9 @@
 			/>
 			<Tool
 				Name="VCLinkerTool"
-				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libeay32MT.lib ssleay32Mt.lib"
+				AdditionalDependencies="wbemuuid.lib ws2_32.lib Crypt32.lib Winscard.lib Packet.lib wpcap.lib libssl.lib libcrypto.lib"
 				LinkIncremental="1"
-				AdditionalLibraryDirectories="C:\dev\WpdPack\lib;C:\dev\openssl\lib"
+                AdditionalLibraryDirectories="..\..\..\..\WpdPack\lib;..\..\..\..\openssl-1.1.1-x86\lib"
 				GenerateDebugInformation="true"
 				SubSystem="1"
 				OptimizeReferences="2"
@@ -183,7 +183,15 @@
 			UniqueIdentifier="{4FC737F1-C7A5-4376-A066-2A32D752A2FF}"
 			>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-cbc.c"
+				RelativePath="..\..\..\src\common\hw_features_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\common\ieee802_11_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\common\wpa_common.c"
 				>
 			</File>
 			<File
@@ -203,71 +211,91 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-unwrap.c"
+				RelativePath="..\..\..\src\crypto\crypto_openssl.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\aes-wrap.c"
+				RelativePath="..\..\..\src\crypto\fips_prf_openssl.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\base64.c"
+				RelativePath="..\..\..\src\crypto\ms_funcs.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\bssid_ignore.c"
+				RelativePath="..\..\..\src\crypto\random.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\bss.c"
+				RelativePath="..\..\..\src\crypto\sha1-prf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_common\chap.c"
+				RelativePath="..\..\..\src\crypto\sha1-tlsprf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\common.c"
+				RelativePath="..\..\..\src\crypto\sha1-tprf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\config.c"
+				RelativePath="..\..\..\src\crypto\sha256-prf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\config.c"
+				RelativePath="..\..\..\src\crypto\sha256-tlsprf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\config_winreg.c"
+				RelativePath="..\..\..\src\crypto\tls_openssl.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\crypto_openssl.c"
+				RelativePath="..\..\..\src\crypto\tls_openssl_ocsp.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\ctrl_iface.c"
+				RelativePath="..\..\..\src\drivers\driver_common.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\ctrl_iface_named_pipe.c"
+				RelativePath="..\..\..\src\drivers\driver_ndis.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\drivers\driver_common.c"
+				RelativePath="..\..\..\src\drivers\driver_ndis_.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\drivers\driver_ndis.c"
+				RelativePath="..\..\..\src\drivers\ndis_events.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\drivers\driver_ndis_.c"
+				RelativePath="..\..\..\src\eap_common\chap.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\drivers\drivers.c"
+				RelativePath="..\..\..\src\eap_common\eap_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_fast_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_pax_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_peap_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_psk_common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_common\eap_sim_common.c"
 				>
 			</File>
 			<File
@@ -275,7 +303,15 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_common\eap_common.c"
+				RelativePath="..\..\..\src\eap_peer\eap_aka.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_fast_pac.c"
 				>
 			</File>
 			<File
@@ -302,16 +338,20 @@
 				RelativePath="..\..\..\src\eap_peer\eap_otp.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\eap_peer\eap_pax.c"
+				>
+			</File>
 			<File
 				RelativePath="..\..\..\src\eap_peer\eap_peap.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_common\eap_peap_common.c"
+				RelativePath="..\..\..\src\eap_peer\eap_psk.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\eap_register.c"
+				RelativePath="..\..\..\src\eap_peer\eap_sim.c"
 				>
 			</File>
 			<File
@@ -331,15 +371,15 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eapol_supp\eapol_supp_sm.c"
+				RelativePath="..\..\..\src\eap_peer\mschapv2.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\eloop_win.c"
+				RelativePath="..\..\..\src\eap_peer\tncc.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\events.c"
+				RelativePath="..\..\..\src\eapol_supp\eapol_supp_sm.c"
 				>
 			</File>
 			<File
@@ -347,27 +387,63 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\main_winsvc.c"
+				RelativePath="..\..\..\src\rsn_supp\pmksa_cache.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\md5.c"
+				RelativePath="..\..\..\src\rsn_supp\preauth.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\ms_funcs.c"
+				RelativePath="..\..\..\src\rsn_supp\wpa.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_peer\mschapv2.c"
+				RelativePath="..\..\..\src\rsn_supp\wpa_ie.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\drivers\ndis_events.c"
+				RelativePath="..\..\..\src\utils\base64.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\notify.c"
+				RelativePath="..\..\..\src\utils\bitfield.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\common.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\config.c"
+				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___utils.obj"
+					/>
+				</FileConfiguration>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\crc32.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\eloop_win.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\..\src\utils\ip_addr.c"
 				>
 			</File>
 			<File
@@ -379,73 +455,105 @@
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\peerkey.c"
+				RelativePath="..\..\..\src\utils\wpa_debug.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\pmksa_cache.c"
+				RelativePath="..\..\..\src\utils\wpabuf.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\preauth.c"
+				RelativePath="..\..\bss.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\scan.c"
+				RelativePath="..\..\bssid_ignore.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1.c"
+				RelativePath="..\..\config.c"
 				>
+				<FileConfiguration
+					Name="Debug|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name="Release|Win32"
+					>
+					<Tool
+						Name="VCCLCompilerTool"
+						ObjectFile="$(IntDir)\config___wpasup.obj"
+					/>
+				</FileConfiguration>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-pbkdf2.c"
+				RelativePath="..\..\ctrl_iface.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-prf.c"
+				RelativePath="..\..\ctrl_iface_named_pipe.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\sha1-tlsprf.c"
+				RelativePath="..\..\eap_register.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\crypto\tls_openssl.c"
+				RelativePath="..\..\events.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\eap_peer\tncc.c"
+				RelativePath="..\..\notify.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\wpa.c"
+				RelativePath="..\..\op_classes.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\common\wpa_common.c"
+				RelativePath="..\..\robust_av.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\wpa_debug.c"
+				RelativePath="..\..\rrm.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\rsn_supp\wpa_ie.c"
+				RelativePath="..\..\scan.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\wpa_supplicant.c"
+				RelativePath="..\..\twt.c"
 				>
 			</File>
 			<File
-				RelativePath="..\..\..\src\utils\wpabuf.c"
+				RelativePath="..\..\wmm_ac.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\wpa_supplicant.c"
 				>
 			</File>
 			<File
 				RelativePath="..\..\wpas_glue.c"
 				>
 			</File>
+			<File
+				RelativePath="..\..\..\src\drivers\drivers.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\config_winreg.c"
+				>
+			</File>
+			<File
+				RelativePath="..\..\main_winsvc.c"
+				>
+			</File>
 		</Filter>
 		<Filter
 			Name="Header Files"
diff --git a/wpa_supplicant/wpa_gui-qt4/icons_status.qrc b/wpa_supplicant/wpa_gui-qt4/icons_status.qrc
index a10371b..6ed8a00 100644
--- a/wpa_supplicant/wpa_gui-qt4/icons_status.qrc
+++ b/wpa_supplicant/wpa_gui-qt4/icons_status.qrc
@@ -1,5 +1,8 @@
 <RCC>
  <qresource prefix="/icons/status" >
+  <file alias="network-wireless-offline.png">icons/wpa_gui.png</file>
+  <file alias="network-wireless-acquiring.png">icons/wpa_gui.png</file>
+  <file alias="network-wireless-connected.png">icons/wpa_gui.png</file>
   <file alias="network-wireless-signal-none.png">icons/status/nm-signal-00.png</file>
   <file alias="network-wireless-signal-weak.png">icons/status/nm-signal-25.png</file>
   <file alias="network-wireless-signal-ok.png">icons/status/nm-signal-50.png</file>
diff --git a/wpa_supplicant/wpa_gui-qt4/wpagui.cpp b/wpa_supplicant/wpa_gui-qt4/wpagui.cpp
index daf2652..9cd84a7 100644
--- a/wpa_supplicant/wpa_gui-qt4/wpagui.cpp
+++ b/wpa_supplicant/wpa_gui-qt4/wpagui.cpp
@@ -1849,7 +1849,7 @@ void ErrorMsg::showMsg(QString msg)
 #ifdef UNICODE
 		QString msg = QString::fromWCharArray(buf);
 #else
-        QString msg = QString::fromLocal8Bit(buf);
+		QString msg = QString::fromLocal8Bit(buf);
 #endif
 		setInformativeText(QString("[%1] %2").arg(err).arg(msg));
 		LocalFree(buf);
-- 
2.30.2

